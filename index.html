<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tax Estimator</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', 'Helvetica Neue', sans-serif;
      background: radial-gradient(ellipse at 20% 50%, rgba(13, 110, 253, 0.15) 0%, transparent 50%), 
                  radial-gradient(ellipse at 80% 80%, rgba(111, 66, 193, 0.15) 0%, transparent 50%),
                  linear-gradient(135deg, #0a0e27 0%, #16213e 50%, #0f3460 100%);
      background-attachment: fixed;
      overflow: auto;
      color: #e0e0e0;
    }

    #app-wrapper {
      width: 100%;
      height: 100%;
      padding: 60px 20px;
      overflow: auto;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 50px;
      animation: glitchIn 0.8s ease-out;
      position: relative;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, rgba(0, 212, 255, 0.3) 0%, transparent 70%);
      border-radius: 50%;
      filter: blur(30px);
    }

    .header h1 {
      font-size: 3.2em;
      margin: 0;
      font-weight: 800;
      letter-spacing: -1px;
      background: linear-gradient(135deg, #00d4ff 0%, #0099ff 25%, #6366f1 50%, #a855f7 75%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 40px rgba(0, 212, 255, 0.2);
      animation: textShimmer 3s infinite;
    }

    .header p {
      font-size: 1.1em;
      margin: 12px 0 0 0;
      opacity: 0.7;
      font-weight: 300;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #00d4ff;
    }

    .card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(0, 212, 255, 0.1);
      border-radius: 16px;
      padding: 28px;
      margin-bottom: 24px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 1px rgba(255, 255, 255, 0.05);
      animation: cardSlideIn 0.6s ease-out forwards;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
      animation: shimmer 3s infinite;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 10px;
      color: #00d4ff;
      font-size: 0.95em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input[type="number"],
    input[type="text"],
    select {
      width: 100%;
      padding: 14px 16px;
      border: 1.5px solid rgba(0, 212, 255, 0.2);
      border-radius: 10px;
      font-size: 1em;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-family: inherit;
      background: rgba(255, 255, 255, 0.02);
      color: #e0e0e0;
    }

    input[type="number"]:focus,
    input[type="text"]:focus,
    select:focus {
      outline: none;
      border-color: #00d4ff;
      background: rgba(0, 212, 255, 0.05);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.3), inset 0 0 10px rgba(0, 212, 255, 0.1);
      transform: translateY(-2px);
    }

    .input-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 640px) {
      .input-group {
        grid-template-columns: 1fr;
      }
    }

    .tab-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .tab-btn {
      padding: 16px 20px;
      border: 2px solid rgba(0, 212, 255, 0.2);
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1em;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      color: #a0a0a0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
    }

    .tab-btn.active {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.15) 0%, rgba(111, 66, 193, 0.15) 100%);
      color: #00d4ff;
      border-color: #00d4ff;
      transform: translateY(-3px);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.1);
    }

    .hidden {
      display: none !important;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid rgba(0, 212, 255, 0.1);
      border-radius: 10px;
      margin-bottom: 20px;
    }

    input[type="checkbox"] {
      width: 22px;
      height: 22px;
      cursor: pointer;
      accent-color: #00d4ff;
    }

    .checkbox-label {
      margin: 0;
      cursor: pointer;
      font-weight: 600;
      color: #e0e0e0;
    }

    .section-title {
      font-size: 1.25em;
      font-weight: 700;
      color: #00d4ff;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(0, 212, 255, 0.2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .calc-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #00d4ff 0%, #0099ff 50%, #6366f1 100%);
      color: #0a0e27;
      border: none;
      border-radius: 12px;
      font-size: 1.15em;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      margin-top: 24px;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
    }

    .calc-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 40px rgba(0, 212, 255, 0.5);
    }

    .results-section {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(111, 66, 193, 0.1) 100%);
      border: 2px solid rgba(0, 212, 255, 0.3);
      border-radius: 16px;
      padding: 32px;
      color: #e0e0e0;
      animation: resultsPulse 0.8s ease-out;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .results-section h2 {
      margin-top: 0;
      margin-bottom: 28px;
      font-size: 1.8em;
      color: #00d4ff;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .result-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 16px;
      padding-bottom: 14px;
      border-bottom: 1px solid rgba(0, 212, 255, 0.1);
    }

    .result-row:last-child {
      border-bottom: none;
    }

    .result-label {
      font-weight: 600;
      opacity: 0.8;
      color: #a0a0a0;
    }

    .result-value {
      font-weight: 800;
      font-size: 1.2em;
      text-align: right;
      color: #00d4ff;
    }

    .disclaimer {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.2);
      padding: 18px;
      border-radius: 10px;
      margin-top: 24px;
      font-size: 0.9em;
      color: #fcd34d;
      line-height: 1.6;
      backdrop-filter: blur(10px);
    }

    @keyframes glitchIn {
      0% { opacity: 0; transform: translateY(-30px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes cardSlideIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    @keyframes textShimmer {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.9; }
    }

    @keyframes resultsPulse {
      0% { opacity: 0; transform: scale(0.95); }
      100% { opacity: 1; transform: scale(1); }
    }

    .optimization-tabs {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 8px;
      margin-bottom: 24px;
    }

    @media (max-width: 1024px) {
      .optimization-tabs {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 640px) {
      .optimization-tabs {
        grid-template-columns: 1fr;
      }
    }

    .opt-tab {
      padding: 12px 16px;
      background: rgba(0, 212, 255, 0.05);
      border: 1.5px solid rgba(0, 212, 255, 0.15);
      border-radius: 8px;
      color: rgba(224, 224, 224, 0.6);
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9em;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .opt-tab.active {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(99, 102, 241, 0.2) 100%);
      border-color: #00d4ff;
      color: #00d4ff;
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
    }

    .opt-content {
      display: none;
    }

    .opt-content.active {
      display: block;
      animation: fadeIn 0.4s ease-out;
    }

    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    .pro-tip {
      background: rgba(236, 72, 153, 0.05);
      border-left: 4px solid #ec4899;
      padding: 12px 16px;
      border-radius: 6px;
      margin-top: 16px;
      font-size: 0.85em;
      color: #fda4d1;
      line-height: 1.5;
    }

    .tax-savings-indicator {
      background: rgba(34, 197, 94, 0.1);
      border: 2px solid rgba(34, 197, 94, 0.3);
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
      text-align: center;
    }

    .savings-amount {
      font-size: 1.8em;
      font-weight: 800;
      color: #22c55e;
      margin: 8px 0;
    }

    .savings-label {
      color: rgba(224, 224, 224, 0.7);
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="app-wrapper">
   <div class="container">
    <div class="header">
     <h1 id="mainTitle">Professional Tax Estimator</h1>
     <p id="subtitle">US &amp; Canada Tax Calculator</p>
    </div>
    <div class="card">
     <div class="form-group"><label for="country">Select Country</label> <select id="country"> <option value="us">United States</option> <option value="ca">Canada</option> </select>
     </div>
     <div class="form-group"><label for="subRegion">State / Province</label> <select id="subRegion"> <option value="">Select state / province</option> </select>
     </div>
    </div>
    <div class="card">
     <div class="form-group"><label>Tax Type</label>
      <div class="tab-buttons"><button id="personalBtn" class="tab-btn active">Personal</button> <button id="businessBtn" class="tab-btn">Business</button>
      </div>
     </div>
    </div>
    <div id="personalFormSection">
     <div class="card">
      <div class="section-title">
       Filing Status
      </div>
      <div class="form-group"><select id="personalFilingStatus"> <option value="single">Single</option> <option value="married_joint">Married Filing Jointly</option> <option value="married_separate">Married Filing Separately</option> <option value="head">Head of Household</option> </select>
      </div>
     </div>
     <div class="card">
      <div class="section-title">
       Income Sources
      </div>
      <div class="input-group">
       <div class="form-group"><label for="personalWages">W-2 Wages</label> <input type="number" id="personalWages" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="personalSalary">Salary / Self-Employment</label> <input type="number" id="personalSalary" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="personalInterest">Interest Income</label> <input type="number" id="personalInterest" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="personalDividends">Dividends</label> <input type="number" id="personalDividends" placeholder="0.00" min="0">
       </div>
      </div>
     </div>
     <div class="card">
      <div class="section-title">
       Deductions
      </div>
      <div class="checkbox-group"><input type="checkbox" id="useStandardDeduction" checked> <label for="useStandardDeduction" class="checkbox-label">Use Standard Deduction</label>
      </div>
      <div class="form-group" id="itemizedSection" style="display: none;">
       <div class="input-group">
        <div class="form-group"><label for="mortgageInterest">Mortgage Interest</label> <input type="number" id="mortgageInterest" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="propertyTax">Property Tax</label> <input type="number" id="propertyTax" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="studentLoan">Student Loan Interest</label> <input type="number" id="studentLoan" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="charityContributions">Charity Contributions</label> <input type="number" id="charityContributions" placeholder="0.00" min="0">
        </div>
       </div>
      </div>
     </div><!-- US OPTIMIZATION -->
     <div class="card" id="usOptimization">
      <div class="section-title">
       üíé Advanced Tax Optimization (US)
      </div>
      <div class="optimization-tabs"><button class="opt-tab active" data-tab="us-retirement">Retirement</button> <button class="opt-tab" data-tab="us-capital">Capital Gains</button> <button class="opt-tab" data-tab="us-credits">Tax Credits</button> <button class="opt-tab" data-tab="us-strategies">Pro Strategies</button>
      </div>
      <div id="us-retirement-tab" class="opt-content active">
       <div class="input-group">
        <div class="form-group"><label for="traditionalIRA">Traditional IRA ($7,000 limit)</label> <input type="number" id="traditionalIRA" placeholder="0.00" min="0" max="7000">
        </div>
        <div class="form-group"><label for="roth401k">Roth 401(k) ($23,500 limit)</label> <input type="number" id="roth401k" placeholder="0.00" min="0" max="23500">
        </div>
        <div class="form-group"><label for="sepIRA">SEP-IRA (Self-Employed)</label> <input type="number" id="sepIRA" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="hsa">HSA ($4,150 individual limit)</label> <input type="number" id="hsa" placeholder="0.00" min="0" max="4150">
        </div>
       </div>
       <div class="pro-tip">
        üí° Triple tax advantage: Pre-tax contribution, tax-free growth, tax-free withdrawal for medical expenses
       </div>
      </div>
      <div id="us-capital-tab" class="opt-content">
       <div class="input-group">
        <div class="form-group"><label for="longTermCapitalGains">Long-Term Capital Gains (0%, 15%, 20%)</label> <input type="number" id="longTermCapitalGains" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="shortTermCapitalGains">Short-Term Capital Gains (Ordinary)</label> <input type="number" id="shortTermCapitalGains" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="capitalLosses">Capital Losses (Harvesting)</label> <input type="number" id="capitalLosses" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="qualifiedDividends">Qualified Dividends (Preferential)</label> <input type="number" id="qualifiedDividends" placeholder="0.00" min="0">
        </div>
       </div>
       <div class="pro-tip">
        üí° Tax-loss harvesting: Offset gains with losses. Unused losses carry forward indefinitely
       </div>
      </div>
      <div id="us-credits-tab" class="opt-content">
       <div class="input-group">
        <div class="form-group"><label for="childTaxCredit">Child Tax Credit ($2,000/child)</label> <input type="number" id="childTaxCredit" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="earnedIncomeCredit">Earned Income Credit (EITC)</label> <input type="number" id="earnedIncomeCredit" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="educationCredit">Education Credit (AOTC)</label> <input type="number" id="educationCredit" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="energyCredit">Residential Clean Energy (30%)</label> <input type="number" id="energyCredit" placeholder="0.00" min="0">
        </div>
       </div>
       <div class="pro-tip">
        üí° AOTC: Up to $2,500 per student. IRA early withdrawal penalty waiver for qualified education costs
       </div>
      </div>
      <div id="us-strategies-tab" class="opt-content">
       <div class="input-group">
        <div class="form-group"><label for="businessLosses">Net Operating Loss (NOL) Carryforward</label> <input type="number" id="businessLosses" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="homeOfficeDeduction">Home Office Deduction</label> <input type="number" id="homeOfficeDeduction" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="dependentCare">Dependent Care FSA ($5,000)</label> <input type="number" id="dependentCare" placeholder="0.00" min="0" max="5000">
        </div>
        <div class="form-group"><label for="studentLoanRepayment">Student Loan Interest ($2,500)</label> <input type="number" id="studentLoanRepayment" placeholder="0.00" min="0" max="2500">
        </div>
       </div>
       <div class="input-group" style="margin-top: 16px;">
        <div class="form-group"><label for="alternativeMinimumTax">AMT (Alternative Minimum Tax)</label> <input type="number" id="alternativeMinimumTax" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="qbi">Qualified Business Income (QBI) - 20%</label> <input type="number" id="qbi" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="bunching">Income Bunching (Deferred)</label> <input type="number" id="bunching" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="estimated">Estimated Tax Payments (Q1-Q4)</label> <input type="number" id="estimated" placeholder="0.00" min="0">
        </div>
       </div>
       <div class="pro-tip">
        üí° QBI: Self-employed &amp; small business owners get 20% deduction on qualified business income
       </div>
      </div>
     </div><!-- CANADIAN OPTIMIZATION -->
     <div class="card" id="caOptimization" style="display: none;">
      <div class="section-title">
       üíé Advanced Tax Optimization (Canada)
      </div>
      <div class="optimization-tabs"><button class="opt-tab active" data-tab="ca-retirement">RRSP/RESP</button> <button class="opt-tab" data-tab="ca-capital">Investment Income</button> <button class="opt-tab" data-tab="ca-credits">Tax Credits</button> <button class="opt-tab" data-tab="ca-strategies">Pro Strategies</button>
      </div>
      <div id="ca-retirement-tab" class="opt-content active">
       <div class="input-group">
        <div class="form-group"><label for="rrspContribution">RRSP Contribution (Tax Deduction)</label> <input type="number" id="rrspContribution" placeholder="18% prior year income" min="0">
        </div>
        <div class="form-group"><label for="firstTimeHomeBuyer">Home Buyers' Plan ($35,000)</label> <input type="number" id="firstTimeHomeBuyer" placeholder="0.00" min="0" max="35000">
        </div>
        <div class="form-group"><label for="respContribution">RESP Contribution (Grant eligible)</label> <input type="number" id="respContribution" placeholder="0.00" min="0" max="2500">
        </div>
        <div class="form-group"><label for="tfsa">TFSA Contribution ($6,500 limit)</label> <input type="number" id="tfsa" placeholder="0.00" min="0" max="6500">
        </div>
       </div>
       <div class="pro-tip">
        üí° CESG: Government matches 20% of RESP contributions. Free money for education!
       </div>
      </div>
      <div id="ca-capital-tab" class="opt-content">
       <div class="input-group">
        <div class="form-group"><label for="capitalGainsInclusion">Capital Gains (50% inclusion)</label> <input type="number" id="capitalGainsInclusion" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="dividendIncome">Dividend Income (Grossed-up)</label> <input type="number" id="dividendIncome" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="capitalLossesCA">Capital Losses (Carry back/fwd)</label> <input type="number" id="capitalLossesCA" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="foreignInvestmentIncome">Foreign Investment Income</label> <input type="number" id="foreignInvestmentIncome" placeholder="0.00" min="0">
        </div>
       </div>
       <div class="pro-tip">
        üí° TFSA: Tax-free growth &amp; withdrawals. RRSP: Tax-deferred. Use both strategically
       </div>
      </div>
      <div id="ca-credits-tab" class="opt-content">
       <div class="input-group">
        <div class="form-group"><label for="canadaChildBenefit">Canada Child Benefit (Monthly)</label> <input type="number" id="canadaChildBenefit" placeholder="$6,833-$16,997/year" min="0">
        </div>
        <div class="form-group"><label for="gstHstCredit">GST/HST Credit (Quarterly)</label> <input type="number" id="gstHstCredit" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="basicPersonalAmount">Basic Personal Amount (Credit)</label> <input type="number" id="basicPersonalAmount" placeholder="$15,705 non-refundable" min="0">
        </div>
        <div class="form-group"><label for="tuitionCredit">Tuition &amp; Education Credit</label> <input type="number" id="tuitionCredit" placeholder="0.00" min="0">
        </div>
       </div>
       <div class="pro-tip">
        üí° CCB paid monthly (not taxable). Spouse can transfer tuition credits. Maximize benefits
       </div>
      </div>
      <div id="ca-strategies-tab" class="opt-content">
       <div class="input-group">
        <div class="form-group"><label for="splitIncome">Spousal RRSP (Income Splitting)</label> <input type="number" id="splitIncome" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="cpptakeup">CPP/OAS Deferral (Age 60-70)</label> <input type="number" id="cpptakeup" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="businessExpenses">Business Deductions &amp; Expenses</label> <input type="number" id="businessExpenses" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="medicalExpenses">Medical Expense Credit (15%)</label> <input type="number" id="medicalExpenses" placeholder="0.00" min="0">
        </div>
       </div>
       <div class="input-group" style="margin-top: 16px;">
        <div class="form-group"><label for="carryForwardLosses">Loss Carryforwards (3yr back/‚àûfwd)</label> <input type="number" id="carryForwardLosses" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="commonLawSpouse">Common-Law Spouse Benefits</label> <input type="number" id="commonLawSpouse" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="prinicipalResidenceExemption">Principal Residence Exemption</label> <input type="number" id="prinicipalResidenceExemption" placeholder="0.00" min="0">
        </div>
        <div class="form-group"><label for="canadaWorkerBenefit">Canada Worker Benefit</label> <input type="number" id="canadaWorkerBenefit" placeholder="0.00" min="0">
        </div>
       </div>
       <div class="pro-tip">
        üí° Principal Residence Exemption: Tax-free capital gains on principal home. Strategic property designation
       </div>
      </div>
     </div>
    </div>
    <div id="businessFormSection" class="hidden">
     <div class="card">
      <div class="section-title">
       Business Type
      </div>
      <div class="form-group"><select id="businessType"> <option value="sole">Sole Proprietorship</option> <option value="llc">LLC</option> <option value="partnership">Partnership</option> <option value="c_corp">C-Corporation</option> <option value="s_corp">S-Corporation</option> </select>
      </div>
     </div>
     <div class="card">
      <div class="section-title">
       Revenue
      </div>
      <div class="input-group">
       <div class="form-group"><label for="businessGrossReceipts">Gross Receipts</label> <input type="number" id="businessGrossReceipts" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="businessReturns">Returns / Allowances</label> <input type="number" id="businessReturns" placeholder="0.00" min="0">
       </div>
      </div>
     </div>
     <div class="card">
      <div class="section-title">
       Business Expenses
      </div>
      <div class="input-group">
       <div class="form-group"><label for="businessSalaries">Salaries &amp; Wages</label> <input type="number" id="businessSalaries" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="businessRent">Rent</label> <input type="number" id="businessRent" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="businessUtilities">Utilities</label> <input type="number" id="businessUtilities" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="businessSupplies">Supplies</label> <input type="number" id="businessSupplies" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="businessDepreciation">Depreciation</label> <input type="number" id="businessDepreciation" placeholder="0.00" min="0">
       </div>
       <div class="form-group"><label for="businessOtherExpenses">Other Expenses</label> <input type="number" id="businessOtherExpenses" placeholder="0.00" min="0">
       </div>
      </div>
     </div>
    </div><button id="calculateBtn" class="calc-btn">Calculate Tax Estimate</button>
    <div id="resultsSection" class="hidden">
     <div class="results-section">
      <h2>üìä Tax Calculation Summary</h2>
      <div class="result-row">
       <div class="result-label">
        Total Income
       </div>
       <div class="result-value" id="resultTotalIncome">
        $0.00
       </div>
      </div>
      <div class="result-row">
       <div class="result-label">
        Total Deductions
       </div>
       <div class="result-value" id="resultTotalDeductions">
        $0.00
       </div>
      </div>
      <div class="result-row">
       <div class="result-label">
        Taxable Income
       </div>
       <div class="result-value" id="resultTaxableIncome">
        $0.00
       </div>
      </div>
      <div class="result-row">
       <div class="result-label">
        Federal/National Tax
       </div>
       <div class="result-value" id="resultFederalTax">
        $0.00
       </div>
      </div>
      <div class="result-row">
       <div class="result-label">
        State/Province Tax
       </div>
       <div class="result-value" id="resultStateTax">
        $0.00
       </div>
      </div>
      <div class="result-row">
       <div class="result-label">
        <strong>Total Estimated Tax</strong>
       </div>
       <div class="result-value" id="resultTotalTax" style="font-size: 1.4em;">
        $0.00
       </div>
      </div>
      <div class="result-row">
       <div class="result-label">
        Effective Tax Rate
       </div>
       <div class="result-value" id="resultEffectiveRate">
        0.0%
       </div>
      </div>
     </div>
     <div class="disclaimer" id="disclaimerText">
      ‚ö†Ô∏è For estimation purposes only. Not professional tax advice. Please consult a tax professional.
     </div>
    </div>
   </div>
  </div>
  <script>
    const usFederalBrackets = {
      single: [
        { limit: 11600, rate: 0.10 },
        { limit: 47150, rate: 0.12 },
        { limit: 100525, rate: 0.22 },
        { limit: 191950, rate: 0.24 },
        { limit: 243725, rate: 0.32 },
        { limit: 609350, rate: 0.35 },
        { limit: Infinity, rate: 0.37 }
      ],
      married_joint: [
        { limit: 23200, rate: 0.10 },
        { limit: 94300, rate: 0.12 },
        { limit: 201050, rate: 0.22 },
        { limit: 383900, rate: 0.24 },
        { limit: 487450, rate: 0.32 },
        { limit: 731200, rate: 0.35 },
        { limit: Infinity, rate: 0.37 }
      ]
    };

    const usStateRates = {
      'AL': 0.05, 'AK': 0.00, 'AZ': 0.055, 'AR': 0.055, 'CA': 0.093, 'CO': 0.044, 'CT': 0.065, 'DE': 0.066,
      'FL': 0.00, 'GA': 0.055, 'HI': 0.088, 'ID': 0.058, 'IL': 0.0495, 'IN': 0.034, 'IA': 0.06, 'KS': 0.057,
      'KY': 0.05, 'LA': 0.06, 'ME': 0.075, 'MD': 0.0575, 'MA': 0.05, 'MI': 0.044, 'MN': 0.0985, 'MS': 0.05,
      'MO': 0.054, 'MT': 0.069, 'NE': 0.064, 'NV': 0.00, 'NH': 0.00, 'NJ': 0.0637, 'NM': 0.05, 'NY': 0.0685,
      'NC': 0.048, 'ND': 0.027, 'OH': 0.037, 'OK': 0.05, 'OR': 0.0995, 'PA': 0.0307, 'RI': 0.063, 'SC': 0.07,
      'SD': 0.00, 'TN': 0.00, 'TX': 0.00, 'UT': 0.049, 'VT': 0.075, 'VA': 0.059, 'WA': 0.00, 'WV': 0.065,
      'WI': 0.061, 'WY': 0.00, 'DC': 0.085
    };

    const caProvRates = {
      'AB': 0.10, 'BC': 0.0505, 'MB': 0.08, 'NB': 0.09, 'NL': 0.08, 'NS': 0.0879,
      'ON': 0.0505, 'PE': 0.09, 'QC': 0.15, 'SK': 0.10
    };

    const defaultConfig = {
      main_title: 'Professional Tax Estimator',
      subtitle: 'US & Canada Tax Calculator',
      disclaimer: '‚ö†Ô∏è For estimation purposes only. Not professional tax advice. Please consult a tax professional.'
    };

    let currentConfig = { ...defaultConfig };

    window.elementSdk.init({
      defaultConfig,
      onConfigChange: async (config) => {
        currentConfig = config;
        document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
        document.getElementById('subtitle').textContent = config.subtitle || defaultConfig.subtitle;
        document.getElementById('disclaimerText').textContent = config.disclaimer || defaultConfig.disclaimer;
      },
      mapToCapabilities: () => ({
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      }),
      mapToEditPanelValues: (config) => new Map([
        ['main_title', config.main_title || defaultConfig.main_title],
        ['subtitle', config.subtitle || defaultConfig.subtitle],
        ['disclaimer', config.disclaimer || defaultConfig.disclaimer]
      ])
    });

    function populateSubRegions(country) {
      const select = document.getElementById('subRegion');
      select.innerHTML = '<option value="">Select state / province</option>';

      const regions = country === 'us' 
        ? Object.keys(usStateRates).sort()
        : Object.keys(caProvRates).sort();

      regions.forEach(region => {
        const option = document.createElement('option');
        option.value = region;
        option.textContent = region;
        select.appendChild(option);
      });

      if (country === 'us') {
        document.getElementById('usOptimization').style.display = 'block';
        document.getElementById('caOptimization').style.display = 'none';
      } else {
        document.getElementById('usOptimization').style.display = 'none';
        document.getElementById('caOptimization').style.display = 'block';
      }
    }

    function calculateProgressiveTax(income, filingStatus) {
      const brackets = usFederalBrackets[filingStatus] || usFederalBrackets.single;
      let tax = 0;
      let previousLimit = 0;

      for (const bracket of brackets) {
        if (income <= previousLimit) break;
        const taxableInThisBracket = Math.min(income, bracket.limit) - previousLimit;
        tax += taxableInThisBracket * bracket.rate;
        previousLimit = bracket.limit;
      }
      return tax;
    }

    async function calculatePersonalTax() {
      const wages = parseFloat(document.getElementById('personalWages').value) || 0;
      const salary = parseFloat(document.getElementById('personalSalary').value) || 0;
      const interest = parseFloat(document.getElementById('personalInterest').value) || 0;
      const dividends = parseFloat(document.getElementById('personalDividends').value) || 0;

      const totalIncome = wages + salary + interest + dividends;
      const filingStatus = document.getElementById('personalFilingStatus').value;
      const useStandard = document.getElementById('useStandardDeduction').checked;
      const country = document.getElementById('country').value;

      const standardDeductions = {
        us: { single: 14600, married_joint: 29200, married_separate: 14600, head: 21900 },
        ca: 15000
      };

      let deductions = useStandard
        ? (country === 'us' ? (standardDeductions.us[filingStatus] || 14600) : standardDeductions.ca)
        : ((parseFloat(document.getElementById('mortgageInterest').value) || 0) +
           (parseFloat(document.getElementById('propertyTax').value) || 0) +
           (parseFloat(document.getElementById('studentLoan').value) || 0) +
           (parseFloat(document.getElementById('charityContributions').value) || 0));

      // US OPTIMIZATION
      if (country === 'us') {
        const traditionalIRA = parseFloat(document.getElementById('traditionalIRA').value) || 0;
        const sepIRA = parseFloat(document.getElementById('sepIRA').value) || 0;
        const hsa = parseFloat(document.getElementById('hsa').value) || 0;
        const dependentCare = parseFloat(document.getElementById('dependentCare').value) || 0;
        const studentLoanDed = parseFloat(document.getElementById('studentLoanRepayment').value) || 0;
        const homeOffice = parseFloat(document.getElementById('homeOfficeDeduction').value) || 0;
        const nol = parseFloat(document.getElementById('businessLosses').value) || 0;

        const longTermCapGains = parseFloat(document.getElementById('longTermCapitalGains').value) || 0;
        const shortTermCapGains = parseFloat(document.getElementById('shortTermCapitalGains').value) || 0;
        const capitalLosses = parseFloat(document.getElementById('capitalLosses').value) || 0;
        const qualifiedDiv = parseFloat(document.getElementById('qualifiedDividends').value) || 0;

        const childCredit = parseFloat(document.getElementById('childTaxCredit').value) || 0;
        const eicCredit = parseFloat(document.getElementById('earnedIncomeCredit').value) || 0;
        const eduCredit = parseFloat(document.getElementById('educationCredit').value) || 0;
        const energyCredit = parseFloat(document.getElementById('energyCredit').value) || 0;

        const qbi = parseFloat(document.getElementById('qbi').value) || 0;
        const bunching = parseFloat(document.getElementById('bunching').value) || 0;
        const estimatedPaid = parseFloat(document.getElementById('estimated').value) || 0;

        const preTaxDeductions = traditionalIRA + sepIRA + hsa + dependentCare + studentLoanDed + homeOffice + nol;
        const netCapitalGains = Math.max(longTermCapGains + shortTermCapGains - capitalLosses, 0);
        const totalOptimizedIncome = totalIncome + netCapitalGains - preTaxDeductions;
        const adjustedGrossIncome = Math.max(totalOptimizedIncome - bunching, 0);
        const totalDeductionsAdjusted = deductions + preTaxDeductions;
        const taxableIncome = Math.max(adjustedGrossIncome - totalDeductionsAdjusted, 0);

        const qbiDeduction = Math.min(qbi * 0.20, taxableIncome * 0.20);
        let federalTax = calculateProgressiveTax(taxableIncome - qbiDeduction, filingStatus);
        const ltCapGainsTax = longTermCapGains * 0.15;
        federalTax = federalTax + ltCapGainsTax;

        const subRegion = document.getElementById('subRegion').value;
        let stateTax = 0;
        if (subRegion) {
          const rate = usStateRates[subRegion] || 0.05;
          stateTax = (taxableIncome - nol) * rate;
        }

        const totalCredits = childCredit + eicCredit + eduCredit + energyCredit;
        const totalTaxBefore = federalTax + stateTax;
        let totalTax = Math.max(totalTaxBefore - totalCredits - estimatedPaid, 0);

        const effectiveRate = totalOptimizedIncome > 0 ? (totalTax / totalOptimizedIncome) * 100 : 0;
        const baselineTax = calculateProgressiveTax(totalIncome - deductions, filingStatus) + stateTax;
        const taxSavings = Math.max(baselineTax - totalTax, 0);

        document.getElementById('resultTotalIncome').textContent = `$${totalOptimizedIncome.toFixed(2)}`;
        document.getElementById('resultTotalDeductions').textContent = `$${totalDeductionsAdjusted.toFixed(2)}`;
        document.getElementById('resultTaxableIncome').textContent = `$${taxableIncome.toFixed(2)}`;
        document.getElementById('resultFederalTax').textContent = `$${federalTax.toFixed(2)}`;
        document.getElementById('resultStateTax').textContent = `$${stateTax.toFixed(2)}`;
        document.getElementById('resultTotalTax').textContent = `$${totalTax.toFixed(2)}`;
        document.getElementById('resultEffectiveRate').textContent = `${effectiveRate.toFixed(2)}%`;

        const resultsSection = document.getElementById('resultsSection');
        resultsSection.innerHTML = `
          <div class="results-section">
            <h2>üìä Advanced Tax Calculation (US)</h2>
            <div class="result-row">
              <div class="result-label">Total Income</div>
              <div class="result-value">\$${totalOptimizedIncome.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Pre-Tax Deductions</div>
              <div class="result-value">\$${preTaxDeductions.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Standard/Itemized Deductions</div>
              <div class="result-value">\$${deductions.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Taxable Income</div>
              <div class="result-value">\$${taxableIncome.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Federal Tax</div>
              <div class="result-value">\$${federalTax.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">State Tax</div>
              <div class="result-value">\$${stateTax.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Tax Credits</div>
              <div class="result-value" style="color: #22c55e;">-\$${totalCredits.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label"><strong>Total Tax</strong></div>
              <div class="result-value" style="font-size: 1.4em;">\$${totalTax.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Effective Rate</div>
              <div class="result-value">${effectiveRate.toFixed(2)}%</div>
            </div>
          </div>
          ${taxSavings > 0 ? `<div class="tax-savings-indicator"><div class="savings-label">üí∞ Tax Savings</div><div class="savings-amount">\$${taxSavings.toFixed(2)}</div></div>` : ''}
          <div class="disclaimer">‚ö†Ô∏è For estimation purposes only. Consult a tax professional.</div>
          <div class="pro-tip">üí° Strategies used: Traditional IRA deduction, HSA triple-tax advantage, Capital gains tax optimization, QBI 20% deduction, Tax credits, Income bunching</div>
        `;

      } else {
        // CANADIAN OPTIMIZATION
        const rrspContribution = parseFloat(document.getElementById('rrspContribution').value) || 0;
        const homeByersPlan = parseFloat(document.getElementById('firstTimeHomeBuyer').value) || 0;
        const respContribution = parseFloat(document.getElementById('respContribution').value) || 0;
        const tfsa = parseFloat(document.getElementById('tfsa').value) || 0;

        const capitalGains = parseFloat(document.getElementById('capitalGainsInclusion').value) || 0;
        const dividendIncome = parseFloat(document.getElementById('dividendIncome').value) || 0;
        const capitalLossesCA = parseFloat(document.getElementById('capitalLossesCA').value) || 0;
        const foreignIncome = parseFloat(document.getElementById('foreignInvestmentIncome').value) || 0;

        const ccb = parseFloat(document.getElementById('canadaChildBenefit').value) || 0;
        const gstCredit = parseFloat(document.getElementById('gstHstCredit').value) || 0;
        const basicPersonal = parseFloat(document.getElementById('basicPersonalAmount').value) || 0;
        const tuitionCredit = parseFloat(document.getElementById('tuitionCredit').value) || 0;

        const spousalRRSP = parseFloat(document.getElementById('splitIncome').value) || 0;
        const cpppas = parseFloat(document.getElementById('cpptakeup').value) || 0;
        const businessExp = parseFloat(document.getElementById('businessExpenses').value) || 0;
        const medicalExp = parseFloat(document.getElementById('medicalExpenses').value) || 0;
        const carryForward = parseFloat(document.getElementById('carryForwardLosses').value) || 0;
        const prinResidence = parseFloat(document.getElementById('prinicipalResidenceExemption').value) || 0;

        const preaxDeductionsCA = rrspContribution + homeByersPlan + spousalRRSP + businessExp;
        const netCapitalGainsCA = Math.max(capitalGains - capitalLossesCA, 0);
        const totalOptimizedIncomeCA = totalIncome + (netCapitalGainsCA * 0.50) + dividendIncome + foreignIncome - preaxDeductionsCA - carryForward;
        const totalDeductionsCA = deductions + preaxDeductionsCA;
        const taxableIncomeCA = Math.max(totalOptimizedIncomeCA - totalDeductionsCA, 0);

        let federalTaxCA = taxableIncomeCA * 0.15;
        const subRegion = document.getElementById('subRegion').value;
        let provincialTax = 0;
        if (subRegion) {
          const rate = caProvRates[subRegion] || 0.08;
          provincialTax = taxableIncomeCA * rate;
        }

        const totalCreditsCA = ccb + gstCredit + basicPersonal + tuitionCredit;
        let totalTaxCA = Math.max((federalTaxCA + provincialTax) - totalCreditsCA, 0);

        const effectiveRateCA = totalOptimizedIncomeCA > 0 ? (totalTaxCA / totalOptimizedIncomeCA) * 100 : 0;

        document.getElementById('resultTotalIncome').textContent = `$${totalOptimizedIncomeCA.toFixed(2)}`;
        document.getElementById('resultTotalDeductions').textContent = `$${totalDeductionsCA.toFixed(2)}`;
        document.getElementById('resultTaxableIncome').textContent = `$${taxableIncomeCA.toFixed(2)}`;
        document.getElementById('resultFederalTax').textContent = `$${federalTaxCA.toFixed(2)}`;
        document.getElementById('resultStateTax').textContent = `$${provincialTax.toFixed(2)}`;
        document.getElementById('resultTotalTax').textContent = `$${totalTaxCA.toFixed(2)}`;
        document.getElementById('resultEffectiveRate').textContent = `${effectiveRateCA.toFixed(2)}%`;

        const resultsSection = document.getElementById('resultsSection');
        resultsSection.innerHTML = `
          <div class="results-section">
            <h2>üìä Advanced Tax Calculation (Canada)</h2>
            <div class="result-row">
              <div class="result-label">Total Income</div>
              <div class="result-value">\$${totalOptimizedIncomeCA.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">RRSP/Retirement Deductions</div>
              <div class="result-value">\$${preaxDeductionsCA.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Standard Deductions</div>
              <div class="result-value">\$${deductions.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Taxable Income</div>
              <div class="result-value">\$${taxableIncomeCA.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Federal Tax</div>
              <div class="result-value">\$${federalTaxCA.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Provincial Tax</div>
              <div class="result-value">\$${provincialTax.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Tax Credits & Benefits</div>
              <div class="result-value" style="color: #22c55e;">-\$${totalCreditsCA.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label"><strong>Total Tax</strong></div>
              <div class="result-value" style="font-size: 1.4em;">\$${totalTaxCA.toFixed(2)}</div>
            </div>
            <div class="result-row">
              <div class="result-label">Effective Rate</div>
              <div class="result-value">${effectiveRateCA.toFixed(2)}%</div>
            </div>
          </div>
          <div class="disclaimer">‚ö†Ô∏è For estimation purposes only. Consult a tax professional.</div>
          <div class="pro-tip">üí° Strategies used: RRSP deduction, Home Buyers' Plan, CESG matching, Spousal RRSP splitting, Capital gains inclusion (50%), TFSA tax-free growth</div>
        `;
      }

      document.getElementById('resultsSection').classList.remove('hidden');
      document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
    }

    async function calculateBusinessTax() {
      const gross = parseFloat(document.getElementById('businessGrossReceipts').value) || 0;
      const returns = parseFloat(document.getElementById('businessReturns').value) || 0;
      const salaries = parseFloat(document.getElementById('businessSalaries').value) || 0;
      const rent = parseFloat(document.getElementById('businessRent').value) || 0;
      const utilities = parseFloat(document.getElementById('businessUtilities').value) || 0;
      const supplies = parseFloat(document.getElementById('businessSupplies').value) || 0;
      const depreciation = parseFloat(document.getElementById('businessDepreciation').value) || 0;
      const other = parseFloat(document.getElementById('businessOtherExpenses').value) || 0;

      const netRevenue = gross - returns;
      const totalExpenses = salaries + rent + utilities + supplies + depreciation + other;
      const netIncome = Math.max(netRevenue - totalExpenses, 0);

      const businessType = document.getElementById('businessType').value;
      const country = document.getElementById('country').value;
      const taxRate = country === 'us' ? (businessType === 'c_corp' ? 0.21 : 0.20) : 0.26;

      const federalTax = netIncome * taxRate;

      const subRegion = document.getElementById('subRegion').value;
      let stateTax = 0;
      if (subRegion) {
        const rate = country === 'us'
          ? (usStateRates[subRegion] || 0.05) * 0.5
          : (caProvRates[subRegion] || 0.05) * 0.5;
        stateTax = netIncome * rate;
      }

      const totalTax = federalTax + stateTax;
      const effectiveRate = netRevenue > 0 ? (totalTax / netRevenue) * 100 : 0;

      document.getElementById('resultTotalIncome').textContent = `$${netRevenue.toFixed(2)}`;
      document.getElementById('resultTotalDeductions').textContent = `$${totalExpenses.toFixed(2)}`;
      document.getElementById('resultTaxableIncome').textContent = `$${netIncome.toFixed(2)}`;
      document.getElementById('resultFederalTax').textContent = `$${federalTax.toFixed(2)}`;
      document.getElementById('resultStateTax').textContent = `$${stateTax.toFixed(2)}`;
      document.getElementById('resultTotalTax').textContent = `$${totalTax.toFixed(2)}`;
      document.getElementById('resultEffectiveRate').textContent = `${effectiveRate.toFixed(2)}%`;

      document.getElementById('resultsSection').classList.remove('hidden');
      document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
    }

    document.getElementById('country').addEventListener('change', (e) => {
      populateSubRegions(e.target.value);
    });

    document.getElementById('personalBtn').addEventListener('click', () => {
      document.getElementById('personalFormSection').classList.remove('hidden');
      document.getElementById('businessFormSection').classList.add('hidden');
      document.getElementById('personalBtn').classList.add('active');
      document.getElementById('businessBtn').classList.remove('active');
    });

    document.getElementById('businessBtn').addEventListener('click', () => {
      document.getElementById('personalFormSection').classList.add('hidden');
      document.getElementById('businessFormSection').classList.remove('hidden');
      document.getElementById('personalBtn').classList.remove('active');
      document.getElementById('businessBtn').classList.add('active');
    });

    document.getElementById('useStandardDeduction').addEventListener('change', (e) => {
      document.getElementById('itemizedSection').style.display = e.target.checked ? 'none' : 'block';
    });

    document.querySelectorAll('.opt-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        const currentCard = tab.closest('.card');
        
        currentCard.querySelectorAll('.opt-tab').forEach(t => t.classList.remove('active'));
        currentCard.querySelectorAll('.opt-content').forEach(c => c.classList.remove('active'));
        
        tab.classList.add('active');
        currentCard.querySelector(`#${tabName}-tab`).classList.add('active');
      });
    });

    document.getElementById('calculateBtn').addEventListener('click', () => {
      const isPersonal = !document.getElementById('personalFormSection').classList.contains('hidden');
      if (isPersonal) {
        calculatePersonalTax();
      } else {
        calculateBusinessTax();
      }
    });

    populateSubRegions('us');
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cb8821257c6a2bc',t:'MTc3MDY5NDAxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
